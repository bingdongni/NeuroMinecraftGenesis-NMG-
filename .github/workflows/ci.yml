name: NeuroMinecraft Genesis CI/CD

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

env:
  PYTHON_VERSION: "3.10"
  MIN_PYTHON_VERSION: "3.8"

jobs:
  # ç¯å¢ƒæ£€æŸ¥å’Œä¾èµ–æµ‹è¯•
  environment-check:
    name: ğŸ” ç¯å¢ƒæ£€æŸ¥
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: ğŸ“¥ Checkoutä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ è®¾ç½®Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ“¦ ç¼“å­˜pipä¾èµ–
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-
          ${{ runner.os }}-pip-test-
          
    - name: ğŸ”„ æ›´æ–°pip
      run: |
        python -m pip install --upgrade pip
        
    - name: ğŸ“‹ æ£€æŸ¥requirements.txt
      run: |
        if [ ! -f "requirements.txt" ]; then
          echo "âŒ requirements.txt æ–‡ä»¶ä¸å­˜åœ¨"
          exit 1
        fi
        echo "âœ… requirements.txt æ–‡ä»¶å­˜åœ¨"
        
    - name: ğŸ” è¿è¡Œç¯å¢ƒæ£€æŸ¥è„šæœ¬
      run: |
        if [ -f "check_environment.py" ]; then
          python check_environment.py || echo "âš ï¸ ç¯å¢ƒæ£€æŸ¥å‘ç°é—®é¢˜ï¼Œä½†ç»§ç»­æµ‹è¯•"
        else
          echo "âš ï¸ æœªæ‰¾åˆ° check_environment.py"
        fi
        
    - name: ğŸ§ª æµ‹è¯•æ ¸å¿ƒå¯¼å…¥
      run: |
        python -c "
        import sys
        sys.path.append('.')
        
        # æµ‹è¯•æ ¸å¿ƒæ¨¡å—
        core_modules = [
            'utils.brain_engine',
            'agents.evolution.disco_rl_agent',
            'utils.quantum_simulator.quantum_brain',
            'worlds.integrated_environment'
        ]
        
        failed_modules = []
        for module in core_modules:
            try:
                __import__(module)
                print(f'âœ… {module}')
            except ImportError as e:
                print(f'âŒ {module}: {e}')
                failed_modules.append(module)
            except Exception as e:
                print(f'âš ï¸ {module}: {str(e)[:100]}')
        
        if failed_modules:
            print(f'\\nâš ï¸ {len(failed_modules)} ä¸ªæ¨¡å—å¯¼å…¥å¤±è´¥')
        else:
            print('\\nâœ… æ‰€æœ‰æ ¸å¿ƒæ¨¡å—å¯¼å…¥æˆåŠŸ')
        "
        
    - name: ğŸ“Š ç”Ÿæˆæ£€æŸ¥æŠ¥å‘Š
      if: always()
      run: |
        echo "## ğŸ” ç¯å¢ƒæ£€æŸ¥ç»“æœ" > environment_report.md
        echo "- Pythonç‰ˆæœ¬: $(python --version)" >> environment_report.md
        echo "- å¹³å°: $(uname -a)" >> environment_report.md
        echo "- æ—¶é—´: $(date)" >> environment_report.md
        echo "- çŠ¶æ€: ${{ job.status }}" >> environment_report.md
        
    - name: ğŸ“¤ ä¸Šä¼ æ£€æŸ¥æŠ¥å‘Š
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: environment-check-report
        path: environment_report.md

  # å¤šPythonç‰ˆæœ¬æµ‹è¯•
  multi-version-test:
    name: ğŸ Python ${{ matrix.python-version }} æµ‹è¯•
    runs-on: ${{ matrix.os }}
    needs: environment-check
    timeout-minutes: 20
    
    strategy:
      fail-fast: false
      matrix:
        python-version: ["3.8", "3.9", "3.10", "3.11"]
        os: [ubuntu-latest]
        
    steps:
    - name: ğŸ“¥ Checkoutä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ è®¾ç½®Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
        
    - name: ğŸ“¦ ç¼“å­˜pipä¾èµ–
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-py${{ matrix.python-version }}-pip-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-py${{ matrix.python-version }}-pip-
          
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt --timeout 300 || echo "éƒ¨åˆ†ä¾èµ–å®‰è£…å¤±è´¥ï¼Œç»§ç»­æµ‹è¯•"
        
    - name: ğŸ§ª æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
      run: |
        python -c "
        # åŸºç¡€åº“æµ‹è¯•
        try:
            import numpy as np
            print(f'NumPy {np.__version__} - OK')
        except Exception as e:
            print(f'NumPy - FAIL: {e}')
            
        try:
            import pandas as pd
            print(f'Pandas {pd.__version__} - OK')
        except Exception as e:
            print(f'Pandas - FAIL: {e}')
            
        try:
            import matplotlib
            print(f'Matplotlib {matplotlib.__version__} - OK')
        except Exception as e:
            print(f'Matplotlib - FAIL: {e}')
            
        try:
            import torch
            print(f'PyTorch {torch.__version__} - OK')
        except Exception as e:
            print(f'PyTorch - FAIL: {e}')
            
        try:
            import streamlit
            print(f'Streamlit {streamlit.__version__} - OK')
        except Exception as e:
            print(f'Streamlit - FAIL: {e}')
        "
        
    - name: ğŸ–¥ï¸ å¯è§†åŒ–ç»„ä»¶æµ‹è¯•
      run: |
        python -c "
        from importlib import import_module
        
        visualization_libs = ['plotly', 'bokeh', 'seaborn']
        for lib in visualization_libs:
            try:
                module = import_module(lib)
                version = getattr(module, '__version__', 'unknown')
                print(f'{lib} {version} - OK')
            except Exception as e:
                print(f'{lib} - FAIL: {e}')
        "
        
    - name: ğŸŒ ç½‘ç»œç»„ä»¶æµ‹è¯•
      run: |
        python -c "
        from importlib import import_module
        
        network_libs = ['requests', 'websocket', 'websockets']
        for lib in network_libs:
            try:
                module = import_module(lib)
                version = getattr(module, '__version__', 'unknown')
                print(f'{lib} {version} - OK')
            except Exception as e:
                print(f'{lib} - FAIL: {e}')
        "

  # é¡¹ç›®ç»“æ„å®Œæ•´æ€§æ£€æŸ¥
  structure-check:
    name: ğŸ“ é¡¹ç›®ç»“æ„æ£€æŸ¥
    runs-on: ubuntu-latest
    needs: environment-check
    timeout-minutes: 5
    
    steps:
    - name: ğŸ“¥ Checkoutä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ“‹ æ£€æŸ¥å¿…éœ€æ–‡ä»¶
      run: |
        echo "ğŸ” æ£€æŸ¥é¡¹ç›®ç»“æ„..."
        echo "å½“å‰ç›®å½•: $(pwd)"
        
        required_files=(
            "requirements.txt"
            "quickstart.py"
            "check_environment.py"
            "install_dependencies.sh"
            "utils/brain_engine/six_dimension_brain.py"
            "agents/evolution/disco_rl_agent.py"
            "utils/quantum_simulator/quantum_brain.py"
            "worlds/integrated_environment.py"
            "utils/visualization/streamlit_dashboard.py"
        )
        
        optional_files=(
            "worlds/minecraft/server/paper.jar"
            "worlds/minecraft/server/paper-1.21.8-60.jar"
            ".github/workflows/ci.yml"
            ".github/dependabot.yml"
            "README.md"
            "LICENSE"
        )
        
        missing_required=0
        missing_optional=0
        
        echo ""
        echo "ğŸ“„ å¿…éœ€æ–‡ä»¶æ£€æŸ¥:"
        for file in "${required_files[@]}"; do
            if [ -f "$file" ]; then
                echo "  âœ… $file"
            else
                echo "  âŒ $file (ç¼ºå¤±)"
                ((missing_required++))
            fi
        done
        
        echo ""
        echo "ğŸ“„ å¯é€‰æ–‡ä»¶æ£€æŸ¥:"
        for file in "${optional_files[@]}"; do
            if [ -f "$file" ]; then
                echo "  âœ… $file"
            else
                echo "  âš ï¸ $file (ç¼ºå¤±)"
                ((missing_optional++))
            fi
        done
        
        echo ""
        if [ $missing_required -eq 0 ]; then
            echo "âœ… æ‰€æœ‰å¿…éœ€æ–‡ä»¶éƒ½å­˜åœ¨"
        else
            echo "âŒ ç¼ºå°‘ $missing_required ä¸ªå¿…éœ€æ–‡ä»¶"
            exit 1
        fi
        
        if [ $missing_optional -gt 0 ]; then
            echo "âš ï¸ ç¼ºå°‘ $missing_optional ä¸ªå¯é€‰æ–‡ä»¶"
        else
            echo "âœ… æ‰€æœ‰æ¨èæ–‡ä»¶éƒ½å­˜åœ¨"
        fi
        
    - name: ğŸ—‚ï¸ æ£€æŸ¥ç›®å½•ç»“æ„
      run: |
        echo "ğŸ“‚ æ£€æŸ¥ç›®å½•ç»“æ„..."
        
        required_dirs=(
            "utils"
            "agents"
            "worlds"
            "utils/visualization"
            "worlds/minecraft"
        )
        
        for dir in "${required_dirs[@]}"; do
            if [ -d "$dir" ]; then
                echo "  âœ… $dir/"
            else
                echo "  âŒ $dir/ (ç¼ºå¤±)"
                exit 1
            fi
        done
        
        echo "âœ… ç›®å½•ç»“æ„å®Œæ•´"

  # MinecraftæœåŠ¡å™¨æµ‹è¯•
  minecraft-server-test:
    name: ğŸ® MinecraftæœåŠ¡å™¨æµ‹è¯•
    runs-on: ubuntu-latest
    needs: structure-check
    timeout-minutes: 15
    
    steps:
    - name: ğŸ“¥ Checkoutä»£ç 
      uses: actions/checkout@v4
      
    - name: â˜• å®‰è£…Java 17
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '17'
        
    - name: ğŸ“‚ æ‰“å°å½“å‰å·¥ä½œç›®å½•
      run: |
        echo "å½“å‰å·¥ä½œç›®å½•ï¼š$(pwd)"
        ls -la worlds/minecraft/server/ || echo "worlds/minecraft/server/ ä¸å­˜åœ¨ï¼Œå°†åœ¨åç»­æ­¥éª¤åˆ›å»º"
        
    - name: â¬‡ï¸ ä¸‹è½½PaperMCæœåŠ¡å™¨æ ¸å¿ƒ
      run: |
        JAR_DIR="worlds/minecraft/server"
        DOWNLOAD_URL="https://api.papermc.io/v2/projects/paper/versions/1.21/builds/60/downloads/paper-1.21-60.jar"
        
        mkdir -p "$JAR_DIR"
        
        if [ ! -f "$JAR_DIR/paper-1.21.8-60.jar" ]; then
          echo "ğŸ“¥ æ­£åœ¨ä¸‹è½½å¹¶é‡å‘½å paper-1.21.8-60.jar..."
          curl -L -o "$JAR_DIR/paper-1.21.8-60.jar" "$DOWNLOAD_URL"
          if [ $? -ne 0 ]; then
            echo "âŒ ä¸‹è½½å¤±è´¥. è¯·æ£€æŸ¥URLæˆ–ç½‘ç»œè¿æ¥."
            exit 1
          fi
        else
          echo "âœ… paper-1.21.8-60.jar å·²å­˜åœ¨ï¼Œè·³è¿‡ä¸‹è½½"
        fi
        
    - name: ğŸ” æ£€æŸ¥ paper-1.21.8-60.jar æ–‡ä»¶
      run: |
        PAPER_JAR="worlds/minecraft/server/paper-1.21.8-60.jar"
        if [ -f "$PAPER_JAR" ]; then
          echo "âœ… paper-1.21.8-60.jar æ–‡ä»¶å·²å­˜åœ¨"
        else
          echo "âŒ paper-1.21.8-60.jar æ–‡ä»¶ç¼ºå¤±"
          exit 1
        fi

    - name: âš™ï¸ é…ç½®æœåŠ¡å™¨
      run: |
        cd worlds/minecraft/server
        
        if [ ! -f "server.properties" ]; then
          printf 'server-name=NeuroMinecraft\nserver-port=25565\nmax-players=10\nmotd=NeuroMinecraft Genesis Test Server\nonline-mode=false\nallow-nether=true\nallow-flight=false\nallow-cheats=true\nmax-world-size=10000\nannounce-player-achievements=true\nenable-query=true\nenable-rcon=false\nbroadcast-rcon-to-ops=true\nforce-gamemode=false\nforce-difficulty-locked=false\npvp=true\ngenerate-structures=true\nop-permission-level=4\nresource-pack=\nresource-pack-prompt=\nresource-pack-id=\nsync-player-chunk=true\nfunction-permission-level=2\ninitial-enabled-packs=vanilla\n' > server.properties
          echo "âœ… åˆ›å»ºserver.properties"
        else
          echo "âœ… server.properties å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"
        fi
        
        if [ ! -f "eula.txt" ]; then
          echo "eula=true" > eula.txt
          echo "âœ… è‡ªåŠ¨åŒæ„EULA"
        else
          echo "âœ… EULAæ–‡ä»¶å·²å­˜åœ¨"
        fi
        
    - name: ğŸš€ æµ‹è¯•æœåŠ¡å™¨å¯åŠ¨
      run: |
        cd worlds/minecraft/server
        echo "ğŸ”§ æµ‹è¯•PaperMCå¯åŠ¨ (60ç§’è¶…æ—¶)..."
        timeout 60s java -Xms1G -Xmx1G -XX:+UseG1GC -jar paper-1.21.8-60.jar --nogui || echo "â° æœåŠ¡å™¨å¯åŠ¨æµ‹è¯•å®Œæˆ"
        
    - name: ğŸ“Š æµ‹è¯•ç»“æœ
      if: always()
      run: |
        echo "## ğŸ® MinecraftæœåŠ¡å™¨æµ‹è¯•ç»“æœ" > minecraft_test_report.md
        echo "- çŠ¶æ€: ${{ job.status }}" >> minecraft_test_report.md
        echo "- Javaç‰ˆæœ¬: $(java -version 2>&1 | head -n 1)" >> minecraft_test_report.md
        echo "- PaperMC: $(ls -la worlds/minecraft/server/paper-1.21.8-60.jar 2>/dev/null | awk '{print $5}' || echo 'ç¼ºå¤±')" >> minecraft_test_report.md
        
    - name: ğŸ“¤ ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: minecraft-test-report
        path: minecraft_test_report.md

  # å¯è§†åŒ–ç•Œé¢æµ‹è¯•
  visualization-test:
    name: ğŸ“Š å¯è§†åŒ–ç•Œé¢æµ‹è¯•
    runs-on: ubuntu-latest
    needs: environment-check
    timeout-minutes: 10
    
    steps:
    - name: ğŸ“¥ Checkoutä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ è®¾ç½®Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ“¦ å®‰è£…æ ¸å¿ƒä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install streamlit plotly bokeh pandas matplotlib
        
    - name: ğŸ“‹ æ£€æŸ¥å¯è§†åŒ–æ–‡ä»¶
      run: |
        visualization_files=(
            "utils/visualization/streamlit_dashboard.py"
            "utils/visualization/brain_network_3d.py"
            "utils/visualization/advanced_dashboard.py"
            "static/brain_network.html"
            "static/evolution_tree.html"
        )
        
        echo "ğŸ” æ£€æŸ¥å¯è§†åŒ–æ–‡ä»¶:"
        for file in "${visualization_files[@]}"; do
            if [ -f "$file" ]; then
                echo "  âœ… $file"
            else
                echo "  âš ï¸ $file (ç¼ºå¤±)"
            fi
        done
        
    - name: ğŸ§ª æµ‹è¯•Streamlité…ç½®
      run: |
        python -c "
        import os
        import sys
        
        dashboard_path = 'utils/visualization/streamlit_dashboard.py'
        if os.path.exists(dashboard_path):
            sys.path.append('utils/visualization')
            try:
                import streamlit_dashboard
                print('âœ… Streamlitä»ªè¡¨æ¿å¯å¯¼å…¥')
            except Exception as e:
                print(f'âš ï¸ Streamlitä»ªè¡¨æ¿å¯¼å…¥é—®é¢˜: {e}')
        else:
            print('â„¹ï¸ utils/visualization/streamlit_dashboard.py ä¸å­˜åœ¨ï¼Œè·³è¿‡å¯¼å…¥æµ‹è¯•')
        "
        
    - name: ğŸ“± ç”Ÿæˆå¯è§†åŒ–æµ‹è¯•æŠ¥å‘Š
      if: always()
      run: |
        echo "## ğŸ“Š å¯è§†åŒ–æµ‹è¯•ç»“æœ" > visualization_test_report.md
        echo "- çŠ¶æ€: ${{ job.status }}" >> visualization_test_report.md
        echo "- Streamlit: $(pip show streamlit | grep Version || echo 'æœªå®‰è£…')" >> visualization_test_report.md
        echo "- Plotly: $(pip show plotly | grep Version || echo 'æœªå®‰è£…')" >> visualization_test_report.md
        
    - name: ğŸ“¤ ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: visualization-test-report
        path: visualization_test_report.md

  # ä»£ç è´¨é‡æ£€æŸ¥
  code-quality:
    name: ğŸ” ä»£ç è´¨é‡æ£€æŸ¥
    runs-on: ubuntu-latest
    needs: environment-check
    timeout-minutes: 10
    
    steps:
    - name: ğŸ“¥ Checkoutä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ è®¾ç½®Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ“¦ å®‰è£…æ£€æŸ¥å·¥å…·
      run: |
        python -m pip install --upgrade pip
        pip install flake8 black mypy
        
    - name: ğŸ” æ£€æŸ¥Pythonè¯­æ³•
      run: |
        echo "ğŸ” æ£€æŸ¥Pythonæ–‡ä»¶è¯­æ³•..."
        find . -name "*.py" -type f | head -20 | while read file; do
            python -m py_compile "$file" && echo "  âœ… $file" || echo "  âŒ $file"
        done
        
    - name: ğŸ¨ ä»£ç æ ¼å¼æ£€æŸ¥
      if: always()
      run: |
        if command -v flake8 &> /dev/null; then
          echo "ğŸ” è¿è¡ŒFlake8ä»£ç è´¨é‡æ£€æŸ¥..."
          flake8 --version
          flake8 --max-line-length=100 --exclude=venv,__pycache__,.git . || echo "âš ï¸ ä»£ç é£æ ¼é—®é¢˜å·²æ£€æµ‹"
        else
          echo "â„¹ï¸ Flake8æœªå®‰è£…ï¼Œè·³è¿‡ä»£ç é£æ ¼æ£€æŸ¥"
        fi
        
    - name: ğŸ“ ç”Ÿæˆè´¨é‡æŠ¥å‘Š
      if: always()
      run: |
        echo "## ğŸ” ä»£ç è´¨é‡æ£€æŸ¥ç»“æœ" > quality_report.md
        echo "- çŠ¶æ€: ${{ job.status }}" >> quality_report.md
        echo "- Flake8: $(flake8 --version 2>/dev/null || echo 'æœªå®‰è£…')" >> quality_report.md
        echo "- Python: $(python --version)" >> quality_report.md
        
    - name: ğŸ“¤ ä¸Šä¼ è´¨é‡æŠ¥å‘Š
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: code-quality-report
        path: quality_report.md

  # é›†æˆæµ‹è¯•
  integration-test:
    name: ğŸ”— é›†æˆæµ‹è¯•
    runs-on: ubuntu-latest
    needs: [environment-check, structure-check]
    timeout-minutes: 15
    
    steps:
    - name: ğŸ“¥ Checkoutä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ è®¾ç½®Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ“¦ å®‰è£…åŸºç¡€ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install numpy pandas matplotlib torch streamlit plotly requests
        
    - name: ğŸ§ª æµ‹è¯•é¡¹ç›®å¯åŠ¨
      run: |
        if [ -f "quickstart.py" ]; then
          echo "ğŸ”§ æµ‹è¯•quickstart.py..."
          timeout 60s python quickstart.py || echo "â° quickstart.pyæµ‹è¯•å®Œæˆ"
        else
          echo "âš ï¸ quickstart.pyä¸å­˜åœ¨"
        fi
        
    - name: ğŸ§ª æµ‹è¯•å¯¼å…¥æ ¸å¿ƒæ¨¡å—
      run: |
        python -c "
        print('ğŸ” æµ‹è¯•æ ¸å¿ƒæ¨¡å—é›†æˆ...')
        
        import sys
        from pathlib import Path
        
        project_root = Path.cwd()
        sys.path.insert(0, str(project_root))
        
        try:
            import numpy as np
            print(f'âœ… NumPy {np.__version__}')
            
            import pandas as pd
            print(f'âœ… Pandas {pd.__version__}')
            
            import torch
            print(f'âœ… PyTorch {torch.__version__}')
            
            core_modules = [
                'utils.brain_engine',
                'agents.evolution.disco_rl_agent',
                'utils.quantum_simulator.quantum_brain'
            ]
            
            for module in core_modules:
                try:
                    __import__(module)
                    print(f'âœ… {module}')
                except ImportError:
                    print(f'âš ï¸ {module} (å¯¼å…¥å¤±è´¥ï¼Œå¯èƒ½éœ€è¦å®Œæ•´ä¾èµ–)')
        
        except Exception as e:
            print(f'âŒ é›†æˆæµ‹è¯•å¤±è´¥: {e}')
            sys.exit(1)
        "
        
    - name: ğŸ“Š ç”Ÿæˆé›†æˆæµ‹è¯•æŠ¥å‘Š
      if: always()
      run: |
        echo "## ğŸ”— é›†æˆæµ‹è¯•ç»“æœ" > integration_report.md
        echo "- çŠ¶æ€: ${{ job.status }}" >> integration_report.md
        echo "- æ ¸å¿ƒæ¨¡å—: æµ‹è¯•å®Œæˆ" >> integration_report.md
        echo "- æ—¶é—´: $(date)" >> integration_report.md
        
    - name: ğŸ“¤ ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: integration-test-report
        path: integration_report.md

  # æœ€ç»ˆç»“æœæ±‡æ€»
  final-report:
    name: ğŸ“‹ æœ€ç»ˆæŠ¥å‘Š
    runs-on: ubuntu-latest
    needs: [environment-check, multi-version-test, structure-check, minecraft-server-test, visualization-test, code-quality, integration-test]
    if: always()
    
    steps:
    - name: ğŸ“¥ Downloadæ‰€æœ‰æŠ¥å‘Š
      uses: actions/download-artifact@v4
      
    - name: ğŸ“‹ åˆå¹¶æµ‹è¯•æŠ¥å‘Š
      run: |
        echo "# ğŸ NeuroMinecraft Genesis CI/CD æœ€ç»ˆæŠ¥å‘Š" > final_report.md
        echo "" >> final_report.md
        echo "## ğŸ“Š ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€" >> final_report.md
        echo "- ç¯å¢ƒæ£€æŸ¥: ${{ needs.environment-check.result }}" >> final_report.md
        echo "- å¤šç‰ˆæœ¬æµ‹è¯•: ${{ needs.multi-version-test.result }}" >> final_report.md
        echo "- ç»“æ„æ£€æŸ¥: ${{ needs.structure-check.result }}" >> final_report.md
        echo "- Minecraftæµ‹è¯•: ${{ needs.minecraft-server-test.result }}" >> final_report.md
        echo "- å¯è§†åŒ–æµ‹è¯•: ${{ needs.visualization-test.result }}" >> final_report.md
        echo "- ä»£ç è´¨é‡: ${{ needs.code-quality.result }}" >> final_report.md
        echo "- é›†æˆæµ‹è¯•: ${{ needs.integration-test.result }}" >> final_report.md
        echo "" >> final_report.md
        echo "## ğŸ“ˆ æµ‹è¯•æ‘˜è¦" >> final_report.md
        echo "- æ—¶é—´: $(date)" >> final_report.md
        echo "- å¹³å°: ${{ runner.os }}" >> final_report.md
        echo "- Python: ${{ env.PYTHON_VERSION }}" >> final_report.md
        echo "" >> final_report.md
        echo "## ğŸ” è¯¦ç»†æŠ¥å‘Š" >> final_report.md
        echo "è¯·æŸ¥çœ‹å„ä¸ªæµ‹è¯•ä»»åŠ¡çš„artifactsè·å–è¯¦ç»†ç»“æœã€‚" >> final_report.md
        
    - name: ğŸ“¤ ä¸Šä¼ æœ€ç»ˆæŠ¥å‘Š
      uses: actions/upload-artifact@v4
      with:
        name: final-ci-report
        path: final_report.md
        
    - name: ğŸ¯ è®¾ç½®ç»“æœçŠ¶æ€
      run: |
        if [[ "${{ needs.environment-check.result }}" == "success" && 
              "${{ needs.structure-check.result }}" == "success" ]]; then
          echo "âœ… æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸"
        else
          echo "âŒ æ ¸å¿ƒåŠŸèƒ½å­˜åœ¨é—®é¢˜"
        fi
